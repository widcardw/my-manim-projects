# 前情提要

在之前的视频中，我们讲到了动画是怎样构成的，其中最重要的一个函数就是 `interpolate`，能够对两个状态进行补间运算，运算式是这样写的

```python
def interpolate(start, end, alpha):
    return (1 - alpha) * start + alpha * end
```

> 穿插一阶贝塞尔动画

其实在此处 `interpolate` 的含义变成了相对狭义的补间，即**线性插值**. 但对三个值，甚至更多的值进行插值，也能够算作是补间. 因此，在这里我们采用 unity 中的一个函数 `lerp`，即线性插值函数，用于相互区分. 

```python
# 这里的算式和上面其实是一样的，而且我还是更喜欢上面的一种写法
def lerp(p0, p1, t):
    return p0 + (p1 - p0) * t
```

而对于 3 个值 $P_0,P_1,P_2$ 的补间，我们应该如何去思考呢？

首先，我们应该很容易想到，先对某一部分，即 $P_0$ 和 $P_1$，$P_1$ 和 $P_2$ 分别进行线性插值，并分别用 $A,B$ 来标记它们，于是我们有

$$
\begin{aligned}
A&=\text{lerp}(P_0,P_1,t)\\
B&=\text{lerp}(P_1,P_2,t)
\end{aligned}$$

> 穿插两个一阶贝塞尔动画
> 然后再加入它们的补间动画，即二阶贝塞尔

接着，我们再对 $A$ 和 $B$ 进行线性插值，设最终结果为 $R$，于是就有

$$
\begin{aligned}
R(t)&=(1-t)\cdot A + t\cdot B\\
&=(1-t)[(1-t)P_0+tP_1]+t[(1-t)P_1+tP_2]\\
&=P_0(1-t)^2+2P_1(1-t)t+P_2t^2
\end{aligned}
$$

用代码来书写可以写成这样

```python
def quadratic(p0, p1, p2, t):
    A = lerp(p0, p1, t)
    B = lerp(p1, p2, t)
    return lerp(A, B, t)
```

而这其实就是贝塞尔曲线的方程了，这里的方程是二阶的，如果需要用三阶可以继续写下去. 

> 穿插由二阶构造三阶的动画

```python
def cubic(p0, p1, p2, p3, t):
    A = quadratic(p0, p1, p2, t)
    B = quadratic(p1, p2, p3, t)
    return lerp(A, B, t)
```

经过归纳，我们可以得到 $n$ 阶贝塞尔曲线的一般方程

$$B^n(t)=\sum_{i=0}^{n}P_i{n\choose i}(1-t)^{n-i}t^i, 其中{n\choose i}={n!\over i!(n-i)!}$$

# 从贝塞尔曲线到概率模型

> 我知道这一部分很扯，但不知道为什么我就是能想到这一步

$n$ 阶贝塞尔曲线的方程过于复杂，我们先看一个三阶贝塞尔

$$
\begin{aligned}
B^3(t)&={3\choose 0}P_0(1-t)^3+{3\choose 1}P_1(1-t)^2t+{3\choose 2}P_2(1-t)t^2+{3\choose 3}P_3t^3\\
&=P_0(1-t)^3+3P_1(1-t)^2t+3P_2(1-t)t^2+P_3t^3\\
&=(-t^3+3t^2-3t+1)P_0\\
&+(3t^3-6t^2+3t)P_1\\
&+(3t^2-3t^3)P_2\\
&+t^3P_3
\end{aligned}
$$

可以发现，在最后一步把立方、平方等项拆开的时候，这些式子的和很像是一个加权平均数，或者说是一个数学期望. 而更巧合的事情发生了，我们分别设 $P_i$ 的系数是 $a_i(i=0,1,2,3)$，可以发现

$$
a_0+a_1+a_2+a_3=(-t^3+3t^2-3t+1)+(3t^3-6t^2+3t)+(3t^2-3t^3)+t^3=1
$$

也就是说，$a_i(i=0,1,2,3)$ 可以看作是一个随机事件中每个事件的概率，而 $P_i(i=0,1,2,3)$ 可以看作是这些随机事件，$B^3(t)$ 就意味着这些事件的数学期望. 

这么说着抽象的事件似乎会让人摸不着头脑，我们不妨把 $P_i$ 看作是平面或空间内的点（为了方便我们在这里先只看平面），$B^3(t)$ 意味着在 $P_i(i=0,1,2,3)$ 所在平面的某一个区域随机取点，而得到的数学期望. 这个期望**似乎**会随着 $t$ 的改变而改变. 

我们尝试写出这个分布列（随机变量 $X$ 可以取 $P_0,P_1,P_2,P_3$ 中的点）

|$X$|$P_0$|$P_1$|$P_2$|$P_3$|
|:-:|:-:|:-:|:-:|:-:|
|$p$|$(1-t)^3$|$3(1-t)^2t$|$3(1-t)t^2$|$t^3$|

对于 $t$ 取 $[0,1]$ 内的不同值，这个分布列会有不同的结果，而将这个分布列画到坐标轴上，似乎暂时也看不出特别明显的规律. 

但我们反过来思考一下，如果是一个随机变量 $Y'$，满足一个两点分布，即 $Y'\sim \left(\begin{array}{l} 0 & 1 \\ q & p\end{array} \right)$，对这个实验独立地进行 $n$ 次，那么这个实验就变成了贝努利实验，即存在随机变量 $Y\sim B(n,p)$. 对于实验结果，我们有

$$
P(Y=m)={n\choose m}(1-t)^{n-m}t^m\qquad(0\leqslant m \leqslant n,m\in\mathbb{N})
$$

这是一个二项分布，而概率似乎与贝塞尔曲线方程的某些系数一模一样. 同时，这两者也有一些共通性. 在贝塞尔曲线中，$t$ 表示所占的某一段直线或曲线的百分比，取值范围是 $[0,1]$. 而一个事件发生的概率，同样是 $[0,1]$，两者是否有一些巧合呢？或许我们需要增大一下二项分布的样本容量，与此同时增大贝塞尔曲线的阶数，才能看的更加明显. 

# 建立二项分布模型 增大样本容量

> 某人射击打靶，射中的概率为 $p$，每次射击不会相互影响，那么他射 $n$ 枪，求射中目标 $m$ 次的概率. 

在这个题目中，每次射击都是一次独立的贝努利实验，这样的实验做 $n$ 次，击中目标的次数设为随机变量 $X$，那么 $X$ 服从一个二项分布，即 $X\sim B(n,p)$. 

现在还没有代入具体数字，我们似乎没法给出一些明确的答案. 那么我们不妨就让 $n=20, p=0.6$. 在这里我们就不进行模拟了，我们直接用公式算出每一种可取的 $m$ 的概率. 

$$
\begin{aligned}
P(X=m)&={n\choose m}(1-p)^{n-m}p^m\\
&={20\choose m}\left({2\over 5}\right)^{20-m}\left({3\over 5}\right)^m
\end{aligned}
$$

同时，我们用图像画出每个 $m$ 所对应的图像. 在这里，每个方柱的面积（而不是高度）代表 $X$ 取到 $m$ 时的概率. 

![](DiscreteBinomialDistributionScene.png)

可以看到，整个图像呈现出中间高，两边低的样子. 

有时我们可能会遇到这样的问题，假设击中次数为 $m$，求 $P(m_1\leqslant m < m_2)$. 这个问题看上去也并不困难，由于射中次数 $m$ 取不同的值时不会相互干扰，所以有


$$P(m_1\leqslant m<m_2)=\displaystyle\sum_{m=m_1}^{m_2-1}P(X=m)$$

也就是只需要将图中在范围内的矩形面积相加就可以了. 同样地，所有这些事件的概率之和为 $1$，即

$$P(0\leqslant m\leqslant n)=\displaystyle\sum_{m=0}^{n}P(X=m)=1$$

在这里，矩形数量并不多，如果所需要计算的量比较少，那么就可以直接~~手算~~计算机运算相加就可以了. 

但如果样本很多，范围也很大呢？这样用手算一个一个相加肯定是相当耗费精力的. 

# 进一步增大样本容量

现在，我们将试验次数增加. 之前提到了用面积来表示 $X=m$ 的概率；但如果用高度来表示，那么这些方柱会越来越矮，最终缩到横轴为止. （3b1b 讲过这件事情）

这时我们发现，我们需要不断地拉长横轴，不妨给横轴除以 $n$，此时横轴表示的，是射中次数与实验次数的商. 纵轴表示的，是 $n$ 乘 $X=m$ 的概率. 从概念上来看，我们所要求的射中 $m$ 枪的概率，变成了射中概率为 ${m\over n}$ 的概率，即“概率的概率”. 

现在，横轴所表示的变量取值范围变成了 $[0,1]$，它所表达的含义似乎很像是概率 $p$. 但在我们平常的概念中，概率 $p$ 可用取到的值应该是 $[0,1]$ 内连续的数. 在上面的例题中，实验次数和击中次数是离散的，只能说，当试验次数充分大时，这种离散的情况可以**近似**的看作是连续的. 也就是说，当二项分布的样本容量足够大时，它的概率分布可以近似地看作是一个连续型的分布. 